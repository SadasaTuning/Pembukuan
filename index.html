<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembukuan Pendapatan</title>
    <meta name="description" content="Aplikasi pembukuan pendapatan bulanan">
    <meta name="theme-color" content="#6366f1"/>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f8fafc;
            --gray: #6b7280;
            --gray-light: #9ca3af;
            --border: #374151;
            --card-bg: #1f2937;
        }

        [data-theme="light"] {
            --dark: #f8fafc;
            --darker: #e2e8f0;
            --light: #1f2937;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --gray: #6b7280;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--light);
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--light);
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .install-btn {
            background: var(--primary);
            border: none;
            padding: 10px 15px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: none;
        }
        
        .install-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .theme-toggle {
            background: var(--primary);
            border: none;
            padding: 10px;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .tab-navigation {
            display: flex;
            margin-bottom: 20px;
            background: var(--darker);
            border-radius: 15px;
            padding: 6px;
            gap: 5px;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-light);
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .tab-button.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .tab-button:hover:not(.active) {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            background: var(--darker);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        input, button, select, textarea {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        input, textarea, select {
            background: var(--dark);
            color: var(--light);
            border-color: var(--border);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        input::placeholder {
            color: var(--gray-light);
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        .summary {
            background: linear-gradient(135deg, var(--secondary), #059669);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .total {
            font-size: 2em;
            font-weight: 700;
            margin-top: 5px;
        }
        
        .month-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .month-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .month-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .month-card.previous {
            border-left: 4px solid var(--info);
        }
        
        .month-card.current {
            border-left: 4px solid var(--secondary);
        }
        
        .month-card h3 {
            font-size: 14px;
            color: var(--gray-light);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .month-card .amount {
            font-size: 1.4em;
            font-weight: 700;
        }
        
        .month-card.previous .amount {
            color: var(--info);
        }
        
        .month-card.current .amount {
            color: var(--secondary);
        }
        
        .transactions {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .transactions::-webkit-scrollbar {
            width: 6px;
        }
        
        .transactions::-webkit-scrollbar-track {
            background: var(--darker);
            border-radius: 10px;
        }
        
        .transactions::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        .transaction-item {
            background: var(--card-bg);
            padding: 16px;
            margin: 10px 0;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .transaction-desc {
            flex: 1;
        }
        
        .transaction-desc strong {
            color: var(--light);
            display: block;
            margin-bottom: 4px;
        }
        
        .transaction-date {
            font-size: 12px;
            color: var(--gray-light);
        }
        
        .transaction-amount {
            font-weight: 700;
            color: var(--secondary);
            font-size: 1.1em;
        }
        
        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }
        
        .empty-state {
            text-align: center;
            color: var(--gray);
            padding: 40px 20px;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .info-text {
            font-size: 12px;
            color: var(--gray-light);
            text-align: center;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        .month-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .month-selector select {
            flex: 1;
        }
        
        .settings-section {
            background: var(--darker);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }
        
        .settings-section h3 {
            margin-bottom: 15px;
            color: var(--light);
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .telegram-info {
            background: var(--info);
            color: white;
            padding: 12px;
            border-radius: 12px;
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .export-btn {
            padding: 12px;
            text-align: center;
            background: var(--info);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .export-btn.excel {
            background: var(--secondary);
        }
        
        .export-btn.csv {
            background: var(--warning);
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .share-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .share-btn {
            padding: 12px;
            text-align: center;
            background: var(--info);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .share-btn.whatsapp {
            background: #25D366;
        }
        
        .share-btn.telegram {
            background: #0088cc;
        }
        
        .share-btn.email {
            background: #D44638;
        }
        
        .share-btn.copy {
            background: var(--primary);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
            font-weight: 600;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: var(--light);
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
        }
        
        .pwa-badge {
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
                border-radius: 16px;
            }
            
            .month-summary {
                grid-template-columns: 1fr;
            }
            
            .export-options, .share-options {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .header {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .install-btn {
                order: -1;
                width: 100%;
                margin-bottom: 10px;
            }
        }

        @media (max-height: 700px) {
            .container {
                padding: 15px;
            }
            
            .input-section {
                padding: 15px;
            }
            
            .transactions {
                max-height: 250px;
            }
        }

        /* Print Styles */
        @media print {
            .tab-navigation, .install-btn, .theme-toggle, .delete-btn {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
            }
            
            body {
                background: white;
                color: black;
                padding: 10px;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <div class="header">
            <button class="install-btn" id="installButton">üì± Install App</button>
            <div style="display: flex; align-items: center;">
                <h1>üìä Pembukuan Bulanan</h1>
                <span class="pwa-badge">PWA</span>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
        
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('input')">Input</button>
            <button class="tab-button" onclick="switchTab('current')">Bulan Ini</button>
            <button class="tab-button" onclick="switchTab('reports')">Laporan</button>
            <button class="tab-button" onclick="switchTab('settings')">Settings</button>
        </div>
        
        <!-- Tab Input -->
        <div id="input-tab" class="tab-content active">
            <div class="input-section">
                <input type="text" id="transactionInput" placeholder="Contoh: remap beat 100rb" autofocus>
                <button onclick="addTransaction()">‚ûï Tambah Pendapatan</button>
                <p class="info-text">Contoh: "service motor 150rb", "jual aksesoris 50rb", "modif 2jt"</p>
            </div>
            
            <div class="month-summary">
                <div class="month-card previous">
                    <h3>üìÖ Bulan Lalu</h3>
                    <div class="amount" id="lastMonthTotal">Rp 0</div>
                </div>
                <div class="month-card current">
                    <h3>üí∞ Bulan Ini</h3>
                    <div class="amount" id="currentMonthTotal">Rp 0</div>
                </div>
            </div>
        </div>
        
        <!-- Tab Bulan Ini -->
        <div id="current-tab" class="tab-content">
            <div class="summary">
                <div>Total Pendapatan Bulan Ini</div>
                <div class="total" id="currentMonthDetailed">Rp 0</div>
            </div>
            
            <div class="transactions" id="currentMonthList">
                <div class="empty-state">
                    <div>üì≠</div>
                    <div>Belum ada transaksi bulan ini</div>
                </div>
            </div>
        </div>
        
        <!-- Tab Laporan -->
        <div id="reports-tab" class="tab-content">
            <div class="month-selector">
                <select id="reportMonth">
                    <!-- Options akan diisi oleh JavaScript -->
                </select>
                <select id="reportYear">
                    <!-- Options akan diisi oleh JavaScript -->
                </select>
            </div>
            
            <div class="summary">
                <div>Total Bulan Terpilih</div>
                <div class="total" id="selectedMonthTotal">Rp 0</div>
            </div>
            
            <div class="transactions" id="reportList">
                <div class="empty-state">
                    <div>üìä</div>
                    <div>Pilih bulan dan tahun</div>
                </div>
            </div>
            
            <div class="export-options">
                <button class="export-btn excel" onclick="exportSelectedMonth('excel')">üìó Export Excel</button>
                <button class="export-btn csv" onclick="exportSelectedMonth('csv')">üìò Export CSV</button>
            </div>
            
            <div class="share-options">
                <button class="share-btn copy" onclick="copyReportToClipboard()">üìã Copy Laporan</button>
                <button class="share-btn whatsapp" onclick="shareToWhatsApp()">üíö WhatsApp</button>
                <button class="share-btn telegram" onclick="shareToTelegram()">üì± Telegram</button>
                <button class="share-btn email" onclick="sendEmailReport()">üìß Email</button>
            </div>
        </div>
        
        <!-- Tab Settings -->
        <div id="settings-tab" class="tab-content">
            <div class="settings-section">
                <h3>‚öôÔ∏è Pengaturan Email</h3>
                <input type="email" id="emailAddress" placeholder="Alamat email tujuan">
                <button onclick="saveEmailSettings()">üíæ Simpan Email</button>
                <p class="info-text">Untuk kirim email otomatis</p>
            </div>
            
            <div class="settings-section">
                <h3>ü§ñ Pengaturan WhatsApp</h3>
                <input type="text" id="whatsappNumber" placeholder="Nomor WhatsApp (62812...)">
                <button onclick="saveWhatsAppSettings()">üíæ Simpan WhatsApp</button>
                <p class="info-text">Format: 6281234567890 (tanpa +)</p>
            </div>
            
            <div class="settings-section">
                <h3>üìä Auto-Export Settings</h3>
                <div class="checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoExport" checked> 
                        Auto-export saat ganti bulan
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoSendEmail"> 
                        Auto-kirim email
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoSendWhatsApp"> 
                        Auto-kirim WhatsApp
                    </label>
                </div>
                <button onclick="saveExportSettings()" style="margin-top: 10px;">üíæ Simpan Settings</button>
            </div>
            
            <div class="settings-section">
                <h3>üõ†Ô∏è Tools</h3>
                <button onclick="clearCurrentMonth()" style="background: var(--warning);">üóëÔ∏è Hapus Bulan Ini</button>
                <button onclick="exportAllData('excel')" style="background: var(--secondary); margin-top: 5px;">üìó Export Semua Data (Excel)</button>
                <button onclick="exportAllData('csv')" style="background: var(--warning); margin-top: 5px;">üìò Export Semua Data (CSV)</button>
                <button onclick="backupData()" style="background: #9C27B0; margin-top: 5px;">üíæ Backup Data</button>
                <button onclick="restoreData()" style="background: #607D8B; margin-top: 5px;">üì• Restore Data</button>
                <button onclick="printReport()" style="background: #6B7280; margin-top: 5px;">üñ®Ô∏è Print Laporan</button>
            </div>

            <div class="settings-section">
                <h3>üì± PWA Info</h3>
                <div class="info-text">
                    <p><strong>Status:</strong> <span id="pwaStatus">Loading...</span></p>
                    <p><strong>Storage:</strong> <span id="storageInfo">Checking...</span></p>
                    <p><strong>Installable:</strong> <span id="installableStatus">Checking...</span></p>
                </div>
                <button onclick="clearAllData()" style="background: var(--danger); margin-top: 10px;">üóëÔ∏è Hapus Semua Data</button>
            </div>
        </div>
    </div>

    <script>
        // ===== PWA FUNCTIONALITY =====
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        // Event listener untuk beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
            updatePWAStatus('Installable - Klik tombol Install');
        });

        // Event listener untuk install button
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installButton.style.display = 'none';
                    showNotification('Aplikasi berhasil diinstall! üéâ');
                    updatePWAStatus('Terinstall');
                }
                deferredPrompt = null;
            }
        });

        // Event listener untuk app installed
        window.addEventListener('appinstalled', () => {
            installButton.style.display = 'none';
            deferredPrompt = null;
            updatePWAStatus('Terinstall');
        });

        // Update PWA status
        function updatePWAStatus(status) {
            document.getElementById('pwaStatus').textContent = status;
            document.getElementById('installableStatus').textContent = 
                deferredPrompt ? 'Ya' : 'Tidak';
        }

        // Check storage usage
        function updateStorageInfo() {
            if (navigator.storage && navigator.storage.estimate) {
                navigator.storage.estimate().then(estimate => {
                    const used = (estimate.usage / 1024 / 1024).toFixed(2);
                    const quota = (estimate.quota / 1024 / 1024).toFixed(2);
                    document.getElementById('storageInfo').textContent = 
                        `${used} MB / ${quota} MB`;
                });
            } else {
                document.getElementById('storageInfo').textContent = 'Tidak tersedia';
            }
        }

        // ===== EVENT LISTENERS COMPLETE =====
        function setupEventListeners() {
            // Keyboard Events
            document.getElementById('transactionInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addTransaction();
            });

            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + N untuk new transaction
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    document.getElementById('transactionInput').focus();
                }
                
                // Escape untuk clear input
                if (e.key === 'Escape') {
                    document.getElementById('transactionInput').value = '';
                    document.getElementById('transactionInput').blur();
                }
                
                // Number shortcuts untuk tabs (1-4)
                if (e.key >= '1' && e.key <= '4' && !e.ctrlKey && !e.metaKey) {
                    e.preventDefault();
                    const tabs = ['input', 'current', 'reports', 'settings'];
                    switchTab(tabs[parseInt(e.key) - 1]);
                }
            });

            // Input Events
            document.getElementById('transactionInput').addEventListener('input', function(e) {
                validateTransactionInput(e.target.value);
            });

            // Tab Events
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.textContent.toLowerCase();
                    switch(tabName) {
                        case 'input': switchTab('input'); break;
                        case 'bulan ini': switchTab('current'); break;
                        case 'laporan': switchTab('reports'); break;
                        case 'settings': switchTab('settings'); break;
                    }
                });
            });

            // Settings Events
            document.getElementById('autoExport').addEventListener('change', function() {
                settings.autoExport = this.checked;
                saveSettings();
            });

            document.getElementById('autoSendEmail').addEventListener('change', function() {
                settings.autoSendEmail = this.checked;
                saveSettings();
            });

            document.getElementById('autoSendWhatsApp').addEventListener('change', function() {
                settings.autoSendWhatsApp = this.checked;
                saveSettings();
            });

            // Auto-save on blur
            document.getElementById('emailAddress').addEventListener('blur', function() {
                if (this.value !== settings.email) {
                    settings.email = this.value;
                    saveSettings();
                    showNotification('Email disimpan!');
                }
            });

            document.getElementById('whatsappNumber').addEventListener('blur', function() {
                if (this.value !== settings.whatsappNumber) {
                    settings.whatsappNumber = this.value;
                    saveSettings();
                    showNotification('Nomor WhatsApp disimpan!');
                }
            });

            // Month/Year selector events
            document.getElementById('reportMonth').addEventListener('change', loadReportView);
            document.getElementById('reportYear').addEventListener('change', loadReportView);

            // Touch Events untuk mobile
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            });

            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });

            // Online/Offline Events
            window.addEventListener('online', function() {
                showNotification('Koneksi internet tersedia üì∂', 'success');
            });

            window.addEventListener('offline', function() {
                showNotification('Anda sedang offline üåê', 'warning');
            });

            // Beforeunload event untuk auto-save
            window.addEventListener('beforeunload', function() {
                saveTransactions();
            });

            // Visibility change event (tab switch)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    // App di background, save data
                    saveTransactions();
                }
            });

            // Context menu prevention (disable right click)
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                }
            });

            // Load event untuk preload resources
            window.addEventListener('load', function() {
                showNotification('Aplikasi siap! üöÄ');
                updateStorageInfo();
            });
        }

        function handleSwipe() {
            const swipeThreshold = 50;
            const swipeDistance = touchEndX - touchStartX;

            if (Math.abs(swipeDistance) > swipeThreshold) {
                if (swipeDistance > 0) {
                    // Swipe right - previous tab
                    navigateTabs(-1);
                } else {
                    // Swipe left - next tab
                    navigateTabs(1);
                }
            }
        }

        function navigateTabs(direction) {
            const tabs = ['input', 'current', 'reports', 'settings'];
            const currentTab = document.querySelector('.tab-button.active').textContent.toLowerCase();
            let currentIndex = tabs.findIndex(tab => 
                tab === currentTab || (currentTab === 'bulan ini' && tab === 'current')
            );
            
            let newIndex = currentIndex + direction;
            if (newIndex < 0) newIndex = tabs.length - 1;
            if (newIndex >= tabs.length) newIndex = 0;
            
            switchTab(tabs[newIndex]);
        }

        function validateTransactionInput(text) {
            const amount = parseAmount(text);
            const input = document.getElementById('transactionInput');
            
            if (amount > 0) {
                input.style.borderColor = 'var(--secondary)';
                input.title = `Terdeteksi: Rp ${amount.toLocaleString('id-ID')}`;
            } else {
                input.style.borderColor = 'var(--border)';
                input.title = 'Masukkan transaksi (contoh: "service 100rb")';
            }
        }

        // ===== SHARING FUNCTIONS =====
        function generateReportMessage() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const data = getTransactionsByMonth(year, month);
            
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                               'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const monthName = monthNames[month - 1];
            const total = data.reduce((sum, t) => sum + t.amount, 0);
            
            return `üìä LAPORAN PENDAPATAN ${monthName.toUpperCase()} ${year}

üí∞ TOTAL: Rp ${total.toLocaleString('id-ID')}

üìã DETAIL TRANSAKSI:
${data.map((t, i) => `${i+1}. ${t.displayDate} - ${t.description} - Rp ${t.amount.toLocaleString('id-ID')}`).join('\n')}

_Generated by Pembukuan App_`;
        }

        function copyReportToClipboard() {
            const message = generateReportMessage();
            if (navigator.clipboard) {
                navigator.clipboard.writeText(message).then(() => {
                    showNotification('Laporan disalin ke clipboard! üìã');
                }).catch(() => {
                    fallbackCopyToClipboard(message);
                });
            } else {
                fallbackCopyToClipboard(message);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('Laporan disalin! üìã');
            } catch (err) {
                showNotification('Gagal menyalin laporan', 'warning');
            }
            document.body.removeChild(textArea);
        }

        function shareToWhatsApp() {
            const message = generateReportMessage();
            const encodedMessage = encodeURIComponent(message);
            
            if (settings.whatsappNumber) {
                const url = `https://api.whatsapp.com/send?phone=${settings.whatsappNumber}&text=${encodedMessage}`;
                window.open(url, '_blank');
            } else {
                const url = `https://wa.me/?text=${encodedMessage}`;
                window.open(url, '_blank');
            }
            showNotification('Membuka WhatsApp... üíö');
        }

        function shareToTelegram() {
            const message = generateReportMessage();
            const encodedMessage = encodeURIComponent(message);
            const url = `https://t.me/share/url?url=${encodeURIComponent('Laporan Pembukuan')}&text=${encodedMessage}`;
            window.open(url, '_blank');
            showNotification('Membuka Telegram... üì±');
        }

        function sendEmailReport() {
            const message = generateReportMessage();
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                               'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const monthName = monthNames[month - 1];
            
            const subject = `Laporan Pendapatan ${monthName} ${year}`;
            const body = message;
            
            if (settings.email) {
                const mailtoLink = `mailto:${settings.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
            } else {
                const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
            }
        }

        function printReport() {
            window.print();
        }

        function clearAllData() {
            if (confirm('HAPUS SEMUA DATA? Tindakan ini tidak dapat dibatalkan!')) {
                localStorage.clear();
                transactions = [];
                settings = {
                    email: '',
                    whatsappNumber: '',
                    autoExport: true,
                    autoSendEmail: false,
                    autoSendWhatsApp: false,
                    theme: 'dark'
                };
                renderAll();
                loadSettings();
                showNotification('Semua data telah dihapus üóëÔ∏è');
            }
        }

        // ===== CORE APP FUNCTIONALITY =====
        // [Semua fungsi core app dari sebelumnya tetap sama]
        // Data dan State Management
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let lastExportMonth = localStorage.getItem('lastExportMonth') || '';
        let settings = JSON.parse(localStorage.getItem('appSettings')) || {
            email: '',
            whatsappNumber: '',
            autoExport: true,
            autoSendEmail: false,
            autoSendWhatsApp: false,
            theme: 'dark'
        };

        // Inisialisasi Aplikasi
        function initializeApp() {
            loadSettings();
            applyTheme();
            checkAutoExport();
            renderAll();
            setupMonthYearSelectors();
            setupEventListeners();
            updatePWAStatus('Aktif');
            updateStorageInfo();
            
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        updatePWAStatus('Aktif + Offline');
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                        updatePWAStatus('Aktif (Online Only)');
                    });
            }
        }

        // [Fungsi-fungsi lainnya tetap sama seperti sebelumnya...]
        // Theme Management, Tab Management, Transaction Management, dll.

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Prevent drag and drop of files
        document.addEventListener('drop', function(e) {
            e.preventDefault();
        });

        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>